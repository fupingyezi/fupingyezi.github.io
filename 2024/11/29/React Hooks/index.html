
  <!DOCTYPE html>
  <html lang="en"  >
  <head>
  <meta charset="utf-8">
  

  

  

  
  <script>window.icon_font = '4552607_tq6stt6tcg';window.clipboard_tips = {"success":"复制成功(*^▽^*)","fail":"复制失败 (ﾟ⊿ﾟ)ﾂ","copyright":{"enable":false,"count":50,"content":"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！"}};</script>
  
  
  <title>
    深入浅出 React Hooks |
    
    Tu Yuheng&#39;s Blog
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic&display=swap" media="print" onload="this.media&#x3D;&#39;all&#39;">
  
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_tq6stt6tcg.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  
    
<link rel="stylesheet" href="/css/loader.css">

  
  
    <meta name="description" content="深入浅出React Hooks 先说一下HOOK的使用规则：  只能在组件中或者其他自定义Hook函数中调用 只能在组件的顶层调用，不能嵌套在if、for、其它的函数中   渲染原理原生HTML+CSS+JAVASCRIPT渲染  整体流程浏览器将HTML解析为DOM树，将CSS解析为样式CSSOM树，然后合成Render渲染树，然后渲染到页面上。是从上到下解析的一个过程。  JavaScript">
<meta property="og:type" content="article">
<meta property="og:title" content="深入浅出 React Hooks">
<meta property="og:url" content="http://fupingyezi.github.io/2024/11/29/React%20Hooks/index.html">
<meta property="og:site_name" content="Tu Yuheng&#39;s Blog">
<meta property="og:description" content="深入浅出React Hooks 先说一下HOOK的使用规则：  只能在组件中或者其他自定义Hook函数中调用 只能在组件的顶层调用，不能嵌套在if、for、其它的函数中   渲染原理原生HTML+CSS+JAVASCRIPT渲染  整体流程浏览器将HTML解析为DOM树，将CSS解析为样式CSSOM树，然后合成Render渲染树，然后渲染到页面上。是从上到下解析的一个过程。  JavaScript">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/preview.png">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/1732718662721.png">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/4bcbf52756d8e89db70c46890e447d5e.jpg">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/1732782540142.png">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/e4a612b54c7871edcc2fc5ed0d730aee.jpg">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/1732788433521.png">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/1732795106793.png">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/755efb653526856c6697b8d3475c50a3.jpg">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/1732799173351.png">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/3219371c3e827df049090d69d4f04787.jpg">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/1732845433892.png">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/1732845884665.png">
<meta property="og:image" content="http://fupingyezi.github.io/images/Rhook/13.png">
<meta property="article:published_time" content="2024-11-29T04:37:08.556Z">
<meta property="article:modified_time" content="2024-12-01T08:16:25.507Z">
<meta property="article:author" content="Tu Yuheng">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fupingyezi.github.io/images/Rhook/preview.png">
  
  
    <link rel="alternate" href="/atom.xml" title="Tu Yuheng's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
  
  
  
    
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"></script>

  
  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css">

  
<meta name="generator" content="Hexo 7.3.0"></head>

  <body>
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
          <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="#ff5252" />
          <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
         M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="#ff5252" />
        </svg>
      </div>
      <div class="loading-word">少女祈祷中...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/">Home</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/archives">Archives</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/about">About</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/friend">Friend</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed" target="_blank"></a>
    
    
    
  </nav>
</div>
<header id="header">
  
    
      <img fetchpriority="high" src="/images/banner.webp" alt="深入浅出 React Hooks">
    
  
  <div id="header-outer">
    <div id="header-title">
      
        
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">深入浅出 React Hooks</h1>
          </a>
        
      
      
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>

        <div id="content">
          
          <section id="main"><article id="post-React Hooks" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <a href="/2024/11/29/React%20Hooks/" class="article-date-link" data-aos="zoom-in">
    <time datetime="2024-11-29T04:37:08.556Z" itemprop="datePublished">2024-11-29</time>
    <time style="display: none;" id="post-update-time">2024-12-01</time>
  </a>
</div>

      

    </div>
    <div class="hr-line"></div>
    

    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h1 id="深入浅出React-Hooks"><a href="#深入浅出React-Hooks" class="headerlink" title="深入浅出React Hooks"></a>深入浅出React Hooks</h1><blockquote>
<p>先说一下HOOK的使用规则：</p>
<ol>
<li>只能在组件中或者其他自定义Hook函数中调用</li>
<li>只能在组件的顶层调用，不能嵌套在if、for、其它的函数中</li>
</ol>
</blockquote>
<h1 id="渲染原理"><a href="#渲染原理" class="headerlink" title="渲染原理"></a>渲染原理</h1><h2 id="原生HTML-CSS-JAVASCRIPT渲染"><a href="#原生HTML-CSS-JAVASCRIPT渲染" class="headerlink" title="原生HTML+CSS+JAVASCRIPT渲染"></a>原生HTML+CSS+JAVASCRIPT渲染</h2><p><img src="/images/Rhook/preview.png" alt="preview"></p>
<blockquote>
<p>整体流程浏览器将HTML解析为DOM树，将CSS解析为样式CSSOM树，然后合成Render渲染树，然后渲染到页面上。是从上到下解析的一个过程。</p>
</blockquote>
<h3 id="JavaScript渲染"><a href="#JavaScript渲染" class="headerlink" title="JavaScript渲染"></a>JavaScript渲染</h3><ol>
<li>在解析HTML过程中，如果<strong>遇到script元素，会停止DOM树的构建，转而下载JavaScript代码并执行JavaScript脚本</strong>，待脚本结束后才会继续解析HTML。</li>
<li>但这有可能会阻塞页面，所以script元素可以通过<code>defer推迟和async异步</code>来适当解决。</li>
<li>注意defer只支持外部JS。</li>
</ol>
<h3 id="DOM发生变化"><a href="#DOM发生变化" class="headerlink" title="DOM发生变化"></a>DOM发生变化</h3><ul>
<li>当DOM发生变化的时候，浏览器会重新解析和渲染DOM树，所以上面的过程会重头又来一遍。在DOM树比较繁杂的时候，效率会很低。</li>
</ul>
<h2 id="虚拟DOM"><a href="#虚拟DOM" class="headerlink" title="虚拟DOM"></a>虚拟DOM</h2><blockquote>
<p>与原生直接操作的真实的DOM树不同，React主要是<strong>操作虚拟DOM</strong>实现更新之类的操作。</p>
</blockquote>
<h3 id="虚拟DOM的定义"><a href="#虚拟DOM的定义" class="headerlink" title="虚拟DOM的定义"></a>虚拟DOM的定义</h3><blockquote>
<p>虚拟DOM是React现代前端框架中的一个核心概念，它是<strong>一个JavaScript对象表示的树状结构，模拟了真实的DOM的结构</strong>。虚拟DOM存在于内存之中，不是真实渲染到页面上的DOM。</p>
</blockquote>
<p><strong>真实DOM与虚拟DOM的区别</strong></p>
<ol>
<li>真实DOM是浏览器的文档对象模型<code>(Document Object Model)</code>的缩写，它代表了整个页面的结构，并且是一个层次化的节点树。在这个树状结构中，每个节点都对应着页面上的一个元素，这些元素可以是HTML标签、文本节点、属性节点等。</li>
<li><code>DOM</code>是很慢的，其元素非常庞大，页面的性能问题，大部分都是由<code>DOM</code>操作引起的。一个真实的DOM，即使是一个简单的div标签也有非常多的属性。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> str = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> div) &#123;</span></span><br><span class="line"><span class="language-javascript">            str += key;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/Rhook/1732718662721.png" alt="73271866272"></p>
<ol start="3">
<li>而虚拟DOM如下，其本质是一个JavaScript对象，也举个“栗子”。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;div&#x27;</span>,  <span class="comment">// 节点类型，这里是&#x27;div&#x27;</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">className</span>: <span class="string">&#x27;container&#x27;</span>,  <span class="comment">// 节点属性，这里是className</span></span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;my-div&#x27;</span>,  <span class="comment">// 另一个节点属性，这里是id</span></span><br><span class="line">    <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">&#x27;blue&#x27;</span> &#125;,  <span class="comment">// 样式属性，可以是一个对象</span></span><br><span class="line">    <span class="attr">onClick</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Div clicked!&#x27;</span>); &#125;  <span class="comment">// 事件监听器，可以是一个函数</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">children</span>: [  <span class="comment">// 子节点数组</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;h1&#x27;</span>,  <span class="comment">// 子节点类型，这里是&#x27;h1&#x27;</span></span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">className</span>: <span class="string">&#x27;title&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">children</span>: [<span class="string">&#x27;Hello, World!&#x27;</span>]  <span class="comment">// 子节点的文本内容</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;p&#x27;</span>,  <span class="comment">// 另一个子节点类型，这里是&#x27;p&#x27;</span></span><br><span class="line">      <span class="attr">props</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">children</span>: [<span class="string">&#x27;This is a paragraph.&#x27;</span>]  <span class="comment">// 另一个子节点的文本内容</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然实际上会比这个复杂一点，但显然相比直接操作真实的DOM，这种方式会高效很多。</p>
<h2 id="React渲染原理"><a href="#React渲染原理" class="headerlink" title="React渲染原理"></a>React渲染原理</h2><h3 id="Fiber架构"><a href="#Fiber架构" class="headerlink" title="Fiber架构"></a>Fiber架构</h3><blockquote>
<p><strong>Fiber架构</strong>是React 16中引入的一种新的协调机制，旨在解决大型应用中性能瓶颈和用户体验问题。在这之前用的是栈式架构，基于递归进行虚拟DOM的比较和更新，但因为<strong>性能的瓶颈和没有工作队列优先级</strong>，被Fiber取代了，下面详细说说Fiber。</p>
</blockquote>
<h4 id="Fiber节点"><a href="#Fiber节点" class="headerlink" title="Fiber节点"></a>Fiber节点</h4><blockquote>
<p>Fiber 节点是 Fiber 架构的核心概念之一，它是<strong>一种虚拟 DOM 的实现方式</strong>。</p>
</blockquote>
<p>Fiber 本质上是一个对象， 使用了<strong>链表结构</strong>。和之前的<code>递归树</code>实现 Virtual DOM 不同的是，对象之间使用链表的结构串联。一个 fiber 包括了 <code>child（第一个子节点）、sibling（同级节点）、return（上一级节点）</code>等属性。</p>
<p>这种方式相比之前好在能够在进行虚拟树比较时，过程可以中断或者恢复。</p>
<h4 id="调度器-Scheduler"><a href="#调度器-Scheduler" class="headerlink" title="调度器 Scheduler"></a>调度器 Scheduler</h4><p>React 定义了不同的优先级级别，如 <code>Immediate</code>（最高优先级，用于处理用户交互）、<code>Normal</code>（默认优先级，一般的更新任务）、<code>Low</code>（低优先级，如后台任务）等。<strong>调度器可以根据任务的优先级来安排它们的执行顺序</strong>，以尽快地响应用户的操作，提升用户体验。</p>
<h4 id="时间切片-TimeSlice"><a href="#时间切片-TimeSlice" class="headerlink" title="时间切片 TimeSlice"></a>时间切片 TimeSlice</h4><p>Fiber 架构引入<strong>时间切片（Time Slicing）</strong> 的概念，即将大的渲染任务分解为多个较小的片段，每个片段都可以在一帧内完成，这样可以防止长时间的任务阻塞主线程，保持界面的流畅性。</p>
<h4 id="双重缓冲-Double-Buffering"><a href="#双重缓冲-Double-Buffering" class="headerlink" title="双重缓冲 Double Buffering"></a>双重缓冲 Double Buffering</h4><p>双重缓冲是一种渲染优化技术，其使用<strong>两个 Fiber 树</strong>来管理渲染，即<strong>当前树 current tree</strong>和<strong>工作树 work-in-progress tree</strong>。当前树代表屏幕上当前显示的内容，而工作树用于准备下一次的渲染更新，用以实现平滑的更新。</p>
<h3 id="渲染流程"><a href="#渲染流程" class="headerlink" title="渲染流程"></a>渲染流程</h3><blockquote>
<p>由以下三个组件决定核心流程：</p>
<ul>
<li><code>Scheduler（调度器）</code>：根据任务的优先级安排任务执行顺序。</li>
<li><code>Reconciler（协调器）</code>：根据新旧虚拟 DOM 树的差异确定需要更新的部分。</li>
<li><code>Renderer（渲染器）</code>：将更新的虚拟 DOM 转换为实际的 UI 输出。</li>
<li><strong>核心流程</strong><img src="/images/Rhook/4bcbf52756d8e89db70c46890e447d5e.jpg" alt="bcbf52756d8e89db70c46890e447d5"></li>
</ul>
</blockquote>
<p><strong>下面主要聚焦render和commit阶段：</strong></p>
<h3 id="Render"><a href="#Render" class="headerlink" title="Render"></a>Render</h3><blockquote>
<p>主要构建虚拟DOM和收集副作用，可中断。</p>
</blockquote>
<h4 id="根组件-渲染起点"><a href="#根组件-渲染起点" class="headerlink" title="根组件-渲染起点"></a>根组件-渲染起点</h4><p><img src="/images/Rhook/1732782540142.png" alt="73278254014"></p>
<h4 id="构建虚拟DOM树"><a href="#构建虚拟DOM树" class="headerlink" title="构建虚拟DOM树"></a>构建虚拟DOM树</h4><ol>
<li>初渲染：从根组件开始，React<strong>会递归调用每个组件的render方法</strong>，生成每个组件的虚拟DOM，直到到达叶子，再返回到根，虚拟DOM树构建完成。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">Header</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">Main</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">Footer</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/Rhook/e4a612b54c7871edcc2fc5ed0d730aee.jpg" alt="4a612b54c7871edcc2fc5ed0d730ae"></p>
<ol start="2">
<li>更新：使用运用diff算法遍历当前树和工作树，只会标记不同的虚拟DOM。</li>
<li>比较DOM树的几个方面：当前根节点类型比较、节点属性比较、子节点比较——主要涉及state、props、context、组件返回的JSX等等。</li>
<li>对React渲染，通常起到关键作用的便是React Hook。</li>
</ol>
<h3 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h3><blockquote>
<p>将虚拟DOM转换为真实DOM，渲染到UI上。</p>
</blockquote>
<h1 id="状态-State"><a href="#状态-State" class="headerlink" title="状态-State"></a>状态-State</h1><blockquote>
<p>用State+事件实现交互。</p>
</blockquote>
<h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><blockquote>
<p>状态——组件的记忆特性。</p>
</blockquote>
<p>先思考一个问题，下面点击click me，index的值会不会递增？页面会不会重新渲染？</p>
<p><img src="/images/Rhook/1732788433521.png" alt="73278843352"></p>
<p>答案是：index增加了，但是页面不会重新渲染。</p>
<p><strong>为什么？</strong></p>
<p>其实组件本质上还是个函数，而普通变量（上面的 <code>index</code>）是<strong>函数作用域内的局部变量</strong>，它们的生命周期仅限于函数调用的执行期间。每次组件函数被调用（即每次组件重新渲染）时，这些变量都会被重新初始化，<strong>在组件每次被渲染的时候都会被重新创建</strong>，并且普通变量并不属于响应式系统，React是不会意识到要用这个局部变量来更新页面的。</p>
<p><strong>怎么解决？</strong></p>
<p>使用状态<code>state</code>和响应事件<code>(on+事件+事件处理函数)</code>来完成响应式交互。</p>
<h2 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h2><blockquote>
<p><code>useState</code>提供了关键的两个功能：</p>
<ol>
<li><strong>State 变量</strong> 用于保存渲染间的数据。</li>
<li><strong>State setter 函数</strong> 更新变量并触发 React 再次渲染组件。</li>
</ol>
</blockquote>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">fuction <span class="title class_">App</span> () &#123;</span><br><span class="line">    <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initialState);</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面想要重新渲染页面就可以改成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span><span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [index, setIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setIndex</span>(index + <span class="number">1</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(index);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;index&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>以useState为例的一类钩子函数一定要在组件顶端使用。</p>
<h2 id="State详解"><a href="#State详解" class="headerlink" title="State详解"></a>State详解</h2><h3 id="State作用域"><a href="#State作用域" class="headerlink" title="State作用域"></a>State作用域</h3><blockquote>
<p>State 不依赖于特定的函数调用或在代码中的位置，它的作用域“只限于”屏幕上的某块特定区域。</p>
</blockquote>
<p>根据官方文档的这个说法，其实我们可以理解为<strong>State是挂载于一个组件的实例上的</strong>，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">    	<span class="language-xml"><span class="tag">&lt;<span class="name">Containter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">Item</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">Item</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">Item</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Containter</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面APP实例化后，App的State、Container的State、三个Item分别的State都是互不影响的，它们<strong>各自的State仅局限于自身，组件挂载时创建，改变时触发组件更新，组件卸载时销毁</strong>。</p>
<p>当然State是可以实现共享的，在之后的组件通信会详细说明。</p>
<h3 id="State帧"><a href="#State帧" class="headerlink" title="State帧"></a>State帧</h3><p>先看个“栗子”：</p>
<p><img src="/images/Rhook/1732795106793.png" alt="73279510679"></p>
<p>那么，点一次加多少？</p>
<blockquote>
<p>官方文档说State相当于一张快照(一帧一帧)，但了解渲染原理之后，我们不妨将其与Fiber架构的双重缓冲机制对应起来，把一帧帧快照统一为<strong>当前帧和工作帧，当前帧是目前渲染在界面上对应VNode的State状态，工作帧是用于更新的VNode的状态。</strong></p>
</blockquote>
<p>而根据渲染机制，当前帧和工作帧是互不影响的，只被React用来比较来决定是否重新渲染，<strong>即当前渲染界面，State始终保持当前帧的值</strong>，不会改变。</p>
<p>并且<strong>React 会等到事件处理函数中的所有代码都运行完毕再处理你的 state 更新。</strong> 这种特性叫做<strong>批处理</strong>。</p>
<h3 id="状态更新函数"><a href="#状态更新函数" class="headerlink" title="状态更新函数"></a>状态更新函数</h3><p>如果我们就想在一次渲染中从内部改变State的值怎么办？——<strong>状态更新函数</strong></p>
<ul>
<li>语法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setState</span>(<span class="function"><span class="params">currentState</span> =&gt;</span> &#123;...&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//栗子</span></span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(n =&gt; n + 1);</span></span><br><span class="line"><span class="language-xml">      	setNumber(n =&gt; n + 1);</span></span><br><span class="line"><span class="language-xml">      	setNumber(n =&gt; n + 1);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;增加数字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>深度理解的，我们实际上是把一系列的State更新操作里，放到了一个更新队列中，所以上面两种不同可以由下图</p>
<p><img src="/images/Rhook/755efb653526856c6697b8d3475c50a3.jpg" alt="55efb653526856c6697b8d3475c50a"></p>
<h1 id="状态管理-Reducer"><a href="#状态管理-Reducer" class="headerlink" title="状态管理-Reducer"></a>状态管理-Reducer</h1><blockquote>
<p>当对State的更新操作总是建立在同一个State上的时候，并且操作方式比较多样的话，可以考虑使用reducer模块化管理。</p>
</blockquote>
<h2 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h2><blockquote>
<p>reducer这个概念其实是从数组的<code>.reduce()</code>方法延伸过来的。</p>
</blockquote>
<p>先看官方的一个例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AddTask</span> <span class="keyword">from</span> <span class="string">&#x27;./AddTask.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TaskList</span> <span class="keyword">from</span> <span class="string">&#x27;./TaskList.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TaskApp</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [tasks, setTasks] = <span class="title function_">useState</span>(initialTasks);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleAddTask</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="title function_">setTasks</span>([</span><br><span class="line">      ...tasks,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: nextId++,</span><br><span class="line">        <span class="attr">text</span>: text,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleChangeTask</span>(<span class="params">task</span>) &#123;</span><br><span class="line">    <span class="title function_">setTasks</span>(</span><br><span class="line">      tasks.<span class="title function_">map</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (t.<span class="property">id</span> === task.<span class="property">id</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> task;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> t;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleDeleteTask</span>(<span class="params">taskId</span>) &#123;</span><br><span class="line">    <span class="title function_">setTasks</span>(tasks.<span class="title function_">filter</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> t.<span class="property">id</span> !== taskId));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>布拉格的行程安排<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">AddTask</span> <span class="attr">onAddTask</span>=<span class="string">&#123;handleAddTask&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TaskList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">tasks</span>=<span class="string">&#123;tasks&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChangeTask</span>=<span class="string">&#123;handleChangeTask&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onDeleteTask</span>=<span class="string">&#123;handleDeleteTask&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> initialTasks = [</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">0</span>, <span class="attr">text</span>: <span class="string">&#x27;参观卡夫卡博物馆&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">&#x27;看木偶戏&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">&#x27;打卡列侬墙&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">];</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到上述都是围绕一个tasks状态进行操作，分为了添加task，改变task和删除task。下面开始阐述如何书写reducer。</p>
<h3 id="定义dispatch的action"><a href="#定义dispatch的action" class="headerlink" title="定义dispatch的action"></a>定义dispatch的action</h3><blockquote>
<p>将所有的逻辑操作各定义为一个action对象，传入一个dispatch函数中。</p>
</blockquote>
<p>上述一共三个操作，所以三个action对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleAddTask</span>(<span class="params">text</span>) &#123;</span><br><span class="line">  <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;added&#x27;</span>,</span><br><span class="line">    <span class="attr">id</span>: nextId++,</span><br><span class="line">    <span class="attr">text</span>: text,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleChangeTask</span>(<span class="params">task</span>) &#123;</span><br><span class="line">  <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;changed&#x27;</span>,</span><br><span class="line">    <span class="attr">task</span>: task,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleDeleteTask</span>(<span class="params">taskId</span>) &#123;</span><br><span class="line">  <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;deleted&#x27;</span>,</span><br><span class="line">    <span class="attr">id</span>: taskId,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：<code>action对象</code>的<code>type</code>属性是必须的，它制定了该action是做什么操作的，其他的由这个操作需要用到什么决定。</p>
<h3 id="定义reducer"><a href="#定义reducer" class="headerlink" title="定义reducer"></a>定义reducer</h3><blockquote>
<p>reducer函数接受两个参数，<code>当前状态和要对状态做的action</code>。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">tasksReducer</span>(<span class="params">tasks, action</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;added&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      ...tasks,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: action.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">text</span>: action.<span class="property">text</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ];</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;changed&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> tasks.<span class="title function_">map</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (t.<span class="property">id</span> === action.<span class="property">task</span>.<span class="property">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> action.<span class="property">task</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;deleted&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> tasks.<span class="title function_">filter</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> t.<span class="property">id</span> !== action.<span class="property">id</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;未知 action: &#x27;</span> + action.<span class="property">type</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上是使用if…else if… else写的，其实结构并不特别清晰，一般用switch写比较好</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">tasksReducer</span>(<span class="params">tasks, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;added&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        ...tasks,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">id</span>: action.<span class="property">id</span>,</span><br><span class="line">          <span class="attr">text</span>: action.<span class="property">text</span>,</span><br><span class="line">          <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;changed&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> tasks.<span class="title function_">map</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (t.<span class="property">id</span> === action.<span class="property">task</span>.<span class="property">id</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> action.<span class="property">task</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> t;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;deleted&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> tasks.<span class="title function_">filter</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> t.<span class="property">id</span> !== action.<span class="property">id</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">default</span>: &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;未知 action: &#x27;</span> + action.<span class="property">type</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h2><blockquote>
<p>当定义了action和reducer后，通过<code>useReducer</code>联系并使用。</p>
</blockquote>
<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRudecer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [ tasks, dispatch ] = <span class="title function_">useReducer</span>(taskReducer, initialTasks);</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h3><p>useState和useReducer干的事本质上是一样的，怎么用看个人喜好。不过模块化编程用useReducer较好，代码逻辑更清晰，而且useReducer也可以用Redux进一步模块化。</p>
<h1 id="组件通信-props、Context"><a href="#组件通信-props、Context" class="headerlink" title="组件通信-props、Context"></a>组件通信-props、Context</h1><h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><blockquote>
<p>前面说了State是独立在一个实例里面的，那么如何实现各组件之间的状态共享呢？</p>
<p>React 组件使用<code>props</code> 来互相通信。<strong>每个父组件都可以提供 props 给它的子组件，从而将一些信息传递给它。</strong>Props 可能会让你想起 HTML 属性，但<strong>它传递任何 JavaScript 值，包括对象、数组和函数</strong>。</p>
</blockquote>
<h3 id="父子间组件通信-父-子"><a href="#父子间组件通信-父-子" class="headerlink" title="父子间组件通信(父-&gt;子)"></a>父子间组件通信(父-&gt;子)</h3><p><strong>步骤：</strong></p>
<ol>
<li>父组件中在<code>return</code>返回的标签上绑定属性。</li>
<li>在子组件中在形参表通过<code>props</code>接收。</li>
</ol>
<hr>
<p>还是官方的例子来说明：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getImageUrl &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Avatar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">size</span>=<span class="string">&#123;100&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">person</span>=<span class="string">&#123;&#123;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name:</span> &#x27;<span class="attr">Katsuko</span> <span class="attr">Saruhashi</span>&#x27;, </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">imageId:</span> &#x27;<span class="attr">YfeOqp2</span>&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Avatar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">size</span>=<span class="string">&#123;80&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">person</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name:</span> &#x27;<span class="attr">Aklilu</span> <span class="attr">Lemma</span>&#x27;, </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">imageId:</span> &#x27;<span class="attr">OKS67lh</span>&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Avatar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">size</span>=<span class="string">&#123;50&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">person</span>=<span class="string">&#123;&#123;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name:</span> &#x27;<span class="attr">Lin</span> <span class="attr">Lanying</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">imageId:</span> &#x27;<span class="attr">1bX5QH6</span>&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">...</span>) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上父组件是Profile，子组件是Avatar。在父组件中给返回的子组件绑了两个参数，size和person。所以传给子组件的props大致结构：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">size</span>: ...,</span><br><span class="line">    <span class="attr">person</span>: &#123;</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实还有很多属性(下面是什么都没绑定时打印出来的props)</p>
<p><img src="/images/Rhook/1732799173351.png" alt="73279917335"></p>
<p>但我们只需关注我们绑定的属性即可。</p>
<p><strong>使用props</strong></p>
<p>从上述可以发现传入的props其实是个Object对象，传入的属性也是以键&#x2F;值的形式存在于对象之中，于是我们有两种方式来使用props</p>
<ol>
<li>直接在形参表传入props，在子组件用<code>props.属性</code>的语法使用自己需要的属性。</li>
<li>使用解构语法，直接将需要的属性在形参表解构出来，在子组件里直接用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">size</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">person</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">&#123;size, person&#125;</span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(size);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兄弟间通信——状态提升"><a href="#兄弟间通信——状态提升" class="headerlink" title="兄弟间通信——状态提升"></a>兄弟间通信——状态提升</h3><p><strong>如果两个同级组件之间想要实现状态共享怎么办？</strong></p>
<p>我们可以巧用父组件，将需要共享的状态定义到父组件，用props分别传给两个子组件，这样，两个子组件就算是在共享一个状态了。</p>
<p><img src="/images/Rhook/3219371c3e827df049090d69d4f04787.jpg" alt="219371c3e827df049090d69d4f0478"></p>
<h3 id="子—-父"><a href="#子—-父" class="headerlink" title="子—&gt;父"></a>子—&gt;父</h3><p><strong>如果想要子组件的信息传给父怎么办？</strong></p>
<blockquote>
<p>核心思想：用子参数调父函数。</p>
</blockquote>
<p>实现：</p>
<ol>
<li>通过父传子，给子传一个函数过去。</li>
<li>子组件接受函数，用自身的参数来调用这个函数，并且参数用useState管理。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Son</span>(<span class="params">&#123; onGetMsg &#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> sonMsg = <span class="string">&#x27;this is son msg&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 在子组件中执行父组件传递过来的函数 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>onGetMsg(sonMsg)&#125;&gt;send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [msg, setMsg] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getMsg</span> = (<span class="params">msg</span>) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(msg)</span><br><span class="line">      <span class="title function_">setMsg</span>(msg)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 传递父组件中的函数到子组件 */&#125;</span></span><br><span class="line"><span class="language-xml">       this is App, &#123;msg&#125;</span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">Son</span> <span class="attr">onGetMsg</span>=<span class="string">&#123;</span> <span class="attr">getMsg</span> &#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h2><blockquote>
<p>寻常通过props传递，只能通过父传子一级一级传下去，当级数过多就会很难调试，但<code>context(上下文)</code>可以解决这个问题。</p>
<p>React规定：</p>
<p><strong>Context</strong> 允许父组件向其下层无论多深的任何组件提供信息，而无需通过 props 显式传递。</p>
</blockquote>
<h3 id="context"><a href="#context" class="headerlink" title="context"></a>context</h3><blockquote>
<p>Context 让父组件可以为它下面的<strong>整个组件树</strong>提供数据。</p>
</blockquote>
<p><strong>创建：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MsgContext</span> = <span class="title function_">createContext</span>([text]); </span><br></pre></td></tr></table></figure>

<p><strong>绑定</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> msg = <span class="string">&#x27;this is app msg&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 通过Provider组件提供数据，这里是成对标签写法 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MsgContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;msg&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        this is App</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">A</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">MsgContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="useContext-1"><a href="#useContext-1" class="headerlink" title="useContext"></a>useContext</h3><blockquote>
<p>子组件通过useContext从传递的文本中读取数据。</p>
</blockquote>
<p><strong>整体例子</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App -&gt; A -&gt; B</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//导入createContext和useContext</span></span><br><span class="line"><span class="keyword">import</span> &#123; createContext, useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. createContext方法创建一个上下文对象</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MsgContext</span> = <span class="title function_">createContext</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//中间组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      this is A component</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">B</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//底层组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">B</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 3. 在底层组件 通过useContext钩子函数使用数据</span></span><br><span class="line">  <span class="keyword">const</span> msg = <span class="title function_">useContext</span>(<span class="title class_">MsgContext</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      this is B compnent,&#123;msg&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//顶层组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> msg = <span class="string">&#x27;this is app msg&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 2. 在顶层组件 通过Provider组件提供数据，这里是成对标签写法 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MsgContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;msg&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        this is App</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">A</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">MsgContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>

<h1 id="引用值-Ref"><a href="#引用值-Ref" class="headerlink" title="引用值-Ref"></a>引用值-Ref</h1><blockquote>
<p>当你希望组件“记住”某些信息，但又不想让这些信息 <strong>触发新的渲染</strong>时，你可以使用 <code>ref</code> 。</p>
<p><code>ref</code>可以存储 timeout ID、DOM 元素和其他不影响组件渲染输出的对象。</p>
<p>与 state 一样，React 会在每次重新渲染之间保留 ref。但是，设置 state 会重新渲染组件，更改 ref 不会。</p>
</blockquote>
<h2 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h2><blockquote>
<p>通常通过从 React 导入 <code>useRef</code> Hook 来为组件添加一个 ref。</p>
</blockquote>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在你的组件内，调用 <code>useRef</code> Hook 并传入你想要引用的初始值作为唯一参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>比如上述代码就传入了0作为初始引用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">current</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看见useRef<strong>返回的是一个对象</strong>，对象的<strong>current属性</strong>存储了当前ref的引用值。</p>
<p>你可以用 <code>ref.current</code> 属性访问该 ref 的当前值。这个值是有意被设置为可变的，意味着你既可以读取它也可以写入它。具体还有些其他东西。</p>
<p><img src="/images/Rhook/1732845433892.png" alt="73284543389"></p>
<h3 id="Ref操作DOM"><a href="#Ref操作DOM" class="headerlink" title="Ref操作DOM"></a>Ref操作DOM</h3><p><strong>步骤</strong>：</p>
<ol>
<li>组件绑定ref属性，将创建的ref对象传入实现绑定</li>
<li>使用ref的current属性进行操作。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//利用useRef生成ref对象</span></span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onChange</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">      <span class="comment">//inputRef.current获取对象</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(inputRef.<span class="property">current</span>.<span class="property">value</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">     <span class="comment">//绑定</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;/</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/Rhook/1732845884665.png" alt="73284588466"></p>
<p>不过目前只能操作自己的当前组件的DOM元素，<strong>其他组件甚至自己的子组件中的DOM元素都无法获取引用</strong>。</p>
<h2 id="forwardRef"><a href="#forwardRef" class="headerlink" title="forwardRef"></a>forwardRef</h2><blockquote>
<p><code>forwardRef</code> 允许组件使用<code> ref</code>将 DOM 节点暴露给父组件。</p>
</blockquote>
<h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; forwardRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SomeComponent</span> = <span class="title function_">forwardRef</span>(render函数)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyInput</span> = <span class="title function_">forwardRef</span>(<span class="keyword">function</span> <span class="title function_">MyInput</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//栗子</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyInput</span> = <span class="title function_">forwardRef</span>(<span class="keyword">function</span> <span class="title function_">MyInput</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;props.label&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h3><p>给要暴露的DOM绑上父组件传来的ref</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; forwardRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyInput</span> = <span class="title function_">forwardRef</span>(<span class="keyword">function</span> <span class="title function_">MyInput</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; label, ...otherProps &#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;label&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> &#123;<span class="attr">...otherProps</span>&#125; <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后就在父组件使用了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ref.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyInput</span> <span class="attr">label</span>=<span class="string">&quot;Enter your name:&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        编辑</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>ref</code>：父组件传递的 <code>ref</code> 属性。<code>ref</code> 可以是一个对象或函数。如果父组件没有传递一个 ref，那么它将会是 <code>null</code>。你应该将接收到的 <code>ref</code> 转发给另一个组件，或者将其传递给 <code>useImperativeHandle</code>。</li>
</ul>
</blockquote>
<h2 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h2><blockquote>
<p><code>useImperativeHandle</code> 是 React 中的一个 Hook，它能让你自定义由 ref 暴露出来的句柄。</p>
<p>一般是和<code>forwardRef</code>一起用的。</p>
</blockquote>
<h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useImperativeHandle &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useImperativeHandle</span>(ref, createHandle, dependencies?)</span><br><span class="line">                    </span><br><span class="line"><span class="comment">//栗子</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyInput</span> = <span class="title function_">forwardRef</span>(<span class="keyword">function</span> <span class="title function_">MyInput</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// ... 你的方法 ...</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>使用 <code>useImperativeHandle</code> 来暴露一个句柄，它只返回你想要父组件去调用的方法</p>
<h3 id="使用案例-1"><a href="#使用案例-1" class="headerlink" title="使用案例"></a>使用案例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//子</span></span><br><span class="line"><span class="keyword">import</span> &#123; forwardRef, useRef, useImperativeHandle &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyInput</span> = <span class="title function_">forwardRef</span>(<span class="keyword">function</span> <span class="title function_">MyInput</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">focus</span>(<span class="params"></span>) &#123;</span><br><span class="line">        inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">scrollIntoView</span>(<span class="params"></span>) &#123;</span><br><span class="line">        inputRef.<span class="property">current</span>.<span class="title function_">scrollIntoView</span>();</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//父</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyInput</span> <span class="keyword">from</span> <span class="string">&#x27;./MyInput.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ref.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    <span class="comment">// 下方代码不起作用，因为 DOM 节点并未被暴露出来：</span></span><br><span class="line">    <span class="comment">// ref.current.style.opacity = 0.5;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyInput</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your name&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Edit</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>通过命令式句柄暴露出来的方法不一定需要完全匹配 DOM 节点的方法。可以自定义一些方法传出去。</p>
<h1 id="副作用-Effect"><a href="#副作用-Effect" class="headerlink" title="副作用-Effect"></a>副作用-Effect</h1><blockquote>
<p>在React中<code>Effect</code> 的专有定义——<strong>由渲染引起的副作用</strong>。</p>
</blockquote>
<h2 id="useEffect声明Effect"><a href="#useEffect声明Effect" class="headerlink" title="useEffect声明Effect"></a>useEffect声明Effect</h2><blockquote>
<p><code>useEffect</code> 是一个 React Hook，它允许你 <code>将组件与外部系统同步</code>。</p>
</blockquote>
<h3 id="useEffect运行机制"><a href="#useEffect运行机制" class="headerlink" title="useEffect运行机制"></a>useEffect运行机制</h3><ol>
<li><code>useEffect</code> 允许你在组件渲染后执行代码，这些代码可以是任何副作用操作，比如数据获取、订阅外部数据源、与浏览器API交互等。</li>
<li><code>useEffect</code> 可以接受一个依赖项数组作为第二个参数。当依赖项数组中的任何值发生变化时，<code>useEffect</code> 内的代码会重新执行。</li>
<li><code>useEffect</code> 在组件挂载后执行，并且在每次更新后重新执行（如果依赖项发生变化）。在组件卸载时，<code>useEffect</code> 返回一个<strong>清理函数</strong>，用于执行必要的清理操作。</li>
<li><code>useEffect</code> 支持异步操作，这意味着你可以在 <code>useEffect</code> 内部使用 <code>async/await</code> 或 Promise 来处理异步数据获取或与外部系统的交互。</li>
</ol>
<h3 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(setup, dependencies?)</span><br><span class="line"></span><br><span class="line"><span class="comment">//栗子</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createConnection &#125; <span class="keyword">from</span> <span class="string">&#x27;./chat.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ChatRoom</span>(<span class="params">&#123; roomId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [serverUrl, setServerUrl] = <span class="title function_">useState</span>(<span class="string">&#x27;https://localhost:1234&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> connection = <span class="title function_">createConnection</span>(serverUrl, roomId);</span><br><span class="line">    connection.<span class="title function_">connect</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      connection.<span class="title function_">disconnect</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [serverUrl, roomId]);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="依赖项——响应式Effect的响应值"><a href="#依赖项——响应式Effect的响应值" class="headerlink" title="依赖项——响应式Effect的响应值"></a>依赖项——响应式Effect的响应值</h3><blockquote>
<p>React正常组件的生命周期是挂载、更新和卸载，但useEffect的生命周期更像是<strong>伴随着响应值同步，更新同步（断开同步，同步），断开同步。</strong></p>
<p>依赖项通常就会列出响应值，<strong>响应值具体为会随着渲染而产生变化的值</strong>，比如state、props等等。</p>
</blockquote>
<p><strong>注意：</strong></p>
<ol>
<li>空依赖<code>[]</code>表示useEffect在组件渲染后只会执行一次。</li>
<li>如果useEffect的set函数里存在响应值，而依赖项没有响应值，是会报错的。</li>
</ol>
<h3 id="清除函数"><a href="#清除函数" class="headerlink" title="清除函数"></a>清除函数</h3><blockquote>
<p>set函数会选择性地返回一个清除函数，用于在<strong>组件卸载时和重新渲染</strong>后使用。每次使用的时候<strong>都是用的旧值</strong>。</p>
</blockquote>
<h2 id="useEffectEvent"><a href="#useEffectEvent" class="headerlink" title="useEffectEvent"></a>useEffectEvent</h2><blockquote>
<p><code>useEffectEvent</code> 这个 React Hook 让你可以提取非响应式逻辑到 <code>Effect Event</code>中</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ChatRoom</span>(<span class="params">&#123; roomId, theme &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> onConnected = <span class="title function_">useEffectEvent</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">showNotification</span>(<span class="string">&#x27;Connected!&#x27;</span>, theme);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> connection = <span class="title function_">createConnection</span>(serverUrl, roomId);</span><br><span class="line">    connection.<span class="title function_">on</span>(<span class="string">&#x27;connected&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">onConnected</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    connection.<span class="title function_">connect</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> connection.<span class="title function_">disconnect</span>();</span><br><span class="line">  &#125;, [roomId]); <span class="comment">// ✅ 声明所有依赖项</span></span><br><span class="line">  <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h1 id="自定义HOOK"><a href="#自定义HOOK" class="headerlink" title="自定义HOOK"></a>自定义HOOK</h1><blockquote>
<p>概念：自定义Hook是以 <code>use打头的函数</code>，通过自定义Hook函数可以用来<code>实现逻辑的封装和复用</code></p>
</blockquote>
<p><img src="/images/Rhook/13.png" alt="image.png"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装自定义Hook</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 问题: 布尔切换的逻辑 当前组件耦合在一起的 不方便复用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决思路: 自定义hook</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义hook-useToggle</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useToggle</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 可复用的逻辑代码</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">toggle</span> = (<span class="params"></span>) =&gt; <span class="title function_">setValue</span>(!value)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 哪些状态和回调函数需要在其他组件中使用 return</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    value,</span><br><span class="line">    toggle</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//解构出来useToggle里的状态和回调函数</span></span><br><span class="line">  <span class="keyword">const</span> &#123; value, toggle &#125; = <span class="title function_">useToggle</span>()</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;value &amp;&amp; <span class="tag">&lt;<span class="name">div</span>&gt;</span>this is div<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;toggle&#125;</span>&gt;</span>toggle<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>

<p>封装自定义hook通用思路：</p>
<ol>
<li>声明一个以use打头的函数。</li>
<li>在函数体内封装可复用的逻辑（只要是可复用的逻辑）。</li>
<li>把组件中用到的状态或者回调return出去（以对象或者数组）。</li>
<li>在哪个组件中要用到这个逻辑，就执行这个函数，解构出来状态和回调进行使用。</li>
</ol>
<p>其他常用钩子函数：<code>useMemo(缓存计算结果）、useCallback(缓存函数)</code>等。</p>

      
    </div>
    <footer class="article-footer">
      
      
      
      
      
      
      
      

    </footer>
  </div>
  
  <nav id="article-nav" data-aos="fade-up">
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img data-src="https://d-sketon.top/img/backimg/bg1.jpg" data-sizes="auto" alt="" class="lazyload">
          
        
        <a href="/2024/12/05/%E5%B0%81%E8%A3%85%E3%80%81%E7%BB%A7%E6%89%BF%E3%80%81%E5%A4%9A%E6%80%81/"></a>
        <div class="article-nav-caption">Newer</div>
        <h3 class="article-nav-title">
          
            (no title)
          
        </h3>
      </div>
    
    
    <div class="article-nav-link-wrap article-nav-link-right">
      
        
        
          <img data-src="https://d-sketon.top/img/backimg/bg1.jpg" data-sizes="auto" alt="Test Post" class="lazyload">
        
      
      <a href="/2024/10/30/Test-Post/"></a>
      <div class="article-nav-caption">Older</div>
      <h3 class="article-nav-title">
        
          Test Post
        
      </h3>
    </div>
    
  </nav>


</article>






</section>
          
            <aside id="sidebar">
  <div class="sidebar-wrapper wrap-sticky">
    <div class="sidebar-wrap" data-aos="fade-up">
      
        <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAReact-Hooks"><span class="toc-number">1.</span> <span class="toc-text">深入浅出React Hooks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">渲染原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%94%9FHTML-CSS-JAVASCRIPT%E6%B8%B2%E6%9F%93"><span class="toc-number">2.1.</span> <span class="toc-text">原生HTML+CSS+JAVASCRIPT渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaScript%E6%B8%B2%E6%9F%93"><span class="toc-number">2.1.1.</span> <span class="toc-text">JavaScript渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOM%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96"><span class="toc-number">2.1.2.</span> <span class="toc-text">DOM发生变化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9FDOM"><span class="toc-number">2.2.</span> <span class="toc-text">虚拟DOM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9FDOM%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">2.2.1.</span> <span class="toc-text">虚拟DOM的定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86"><span class="toc-number">2.3.</span> <span class="toc-text">React渲染原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fiber%E6%9E%B6%E6%9E%84"><span class="toc-number">2.3.1.</span> <span class="toc-text">Fiber架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Fiber%E8%8A%82%E7%82%B9"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">Fiber节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E5%99%A8-Scheduler"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">调度器 Scheduler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%88%87%E7%89%87-TimeSlice"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">时间切片 TimeSlice</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E9%87%8D%E7%BC%93%E5%86%B2-Double-Buffering"><span class="toc-number">2.3.1.4.</span> <span class="toc-text">双重缓冲 Double Buffering</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.2.</span> <span class="toc-text">渲染流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Render"><span class="toc-number">2.3.3.</span> <span class="toc-text">Render</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E7%BB%84%E4%BB%B6-%E6%B8%B2%E6%9F%93%E8%B5%B7%E7%82%B9"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">根组件-渲染起点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%99%9A%E6%8B%9FDOM%E6%A0%91"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">构建虚拟DOM树</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commit"><span class="toc-number">2.3.4.</span> <span class="toc-text">commit</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8A%B6%E6%80%81-State"><span class="toc-number">3.</span> <span class="toc-text">状态-State</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#State"><span class="toc-number">3.1.</span> <span class="toc-text">State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useState"><span class="toc-number">3.2.</span> <span class="toc-text">useState</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">3.2.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">3.2.2.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#State%E8%AF%A6%E8%A7%A3"><span class="toc-number">3.3.</span> <span class="toc-text">State详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#State%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">3.3.1.</span> <span class="toc-text">State作用域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#State%E5%B8%A7"><span class="toc-number">3.3.2.</span> <span class="toc-text">State帧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.3.</span> <span class="toc-text">状态更新函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86-Reducer"><span class="toc-number">4.</span> <span class="toc-text">状态管理-Reducer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#reducer"><span class="toc-number">4.1.</span> <span class="toc-text">reducer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89dispatch%E7%9A%84action"><span class="toc-number">4.1.1.</span> <span class="toc-text">定义dispatch的action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89reducer"><span class="toc-number">4.1.2.</span> <span class="toc-text">定义reducer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useReducer"><span class="toc-number">4.2.</span> <span class="toc-text">useReducer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9"><span class="toc-number">4.2.2.</span> <span class="toc-text">选择</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1-props%E3%80%81Context"><span class="toc-number">5.</span> <span class="toc-text">组件通信-props、Context</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#props"><span class="toc-number">5.1.</span> <span class="toc-text">props</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E9%97%B4%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1-%E7%88%B6-%E5%AD%90"><span class="toc-number">5.1.1.</span> <span class="toc-text">父子间组件通信(父-&gt;子)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%84%E5%BC%9F%E9%97%B4%E9%80%9A%E4%BF%A1%E2%80%94%E2%80%94%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87"><span class="toc-number">5.1.2.</span> <span class="toc-text">兄弟间通信——状态提升</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E2%80%94-%E7%88%B6"><span class="toc-number">5.1.3.</span> <span class="toc-text">子—&gt;父</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useContext"><span class="toc-number">5.2.</span> <span class="toc-text">useContext</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#context"><span class="toc-number">5.2.1.</span> <span class="toc-text">context</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useContext-1"><span class="toc-number">5.2.2.</span> <span class="toc-text">useContext</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E5%80%BC-Ref"><span class="toc-number">6.</span> <span class="toc-text">引用值-Ref</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#useRef"><span class="toc-number">6.1.</span> <span class="toc-text">useRef</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.1.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ref%E6%93%8D%E4%BD%9CDOM"><span class="toc-number">6.1.2.</span> <span class="toc-text">Ref操作DOM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#forwardRef"><span class="toc-number">6.2.</span> <span class="toc-text">forwardRef</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="toc-number">6.2.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">6.2.2.</span> <span class="toc-text">使用案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useImperativeHandle"><span class="toc-number">6.3.</span> <span class="toc-text">useImperativeHandle</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-3"><span class="toc-number">6.3.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B-1"><span class="toc-number">6.3.2.</span> <span class="toc-text">使用案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%AF%E4%BD%9C%E7%94%A8-Effect"><span class="toc-number">7.</span> <span class="toc-text">副作用-Effect</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#useEffect%E5%A3%B0%E6%98%8EEffect"><span class="toc-number">7.1.</span> <span class="toc-text">useEffect声明Effect</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#useEffect%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6"><span class="toc-number">7.1.1.</span> <span class="toc-text">useEffect运行机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-4"><span class="toc-number">7.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E9%A1%B9%E2%80%94%E2%80%94%E5%93%8D%E5%BA%94%E5%BC%8FEffect%E7%9A%84%E5%93%8D%E5%BA%94%E5%80%BC"><span class="toc-number">7.1.3.</span> <span class="toc-text">依赖项——响应式Effect的响应值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.4.</span> <span class="toc-text">清除函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useEffectEvent"><span class="toc-number">7.2.</span> <span class="toc-text">useEffectEvent</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89HOOK"><span class="toc-number">8.</span> <span class="toc-text">自定义HOOK</span></a></li></ol>
      
  </div>
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Tu Yuheng" class="lazyload">
  <div class="sidebar-author-name">Tu Yuheng</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    <div class="sidebar-state-number">4</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">0</div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">0</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="Home"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="Archives"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="About"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="Friend"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Friend</div>
    </div>
  
</div>
</div>
      
      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  
</aside>

          
        </div>
        <footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    
    <div>
      <span class="icon-copyright"></span>
      2020-2024
      <span class="footer-info-sep"></span>
      Tu Yuheng
    </div>
    
      <div>
        Powered by&nbsp;<a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" rel="noopener external nofollow noreferrer" target="_blank">Reimu</a>
      </div>
    
    
      <div>
        <span class="icon-brush"></span>
        11.5k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        00:47
      </div>
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">Number of visits&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">Number of visitors&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
    
  </div>
</footer>

        <div class="sidebar-top">
          <img src="/images/taichi.png" height="50" width="50" alt="backtop" />
          <div class="arrow-up"></div>
        </div>
        <div id="mask"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAReact-Hooks"><span class="toc-number">1.</span> <span class="toc-text">深入浅出React Hooks</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">渲染原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%94%9FHTML-CSS-JAVASCRIPT%E6%B8%B2%E6%9F%93"><span class="toc-number">2.1.</span> <span class="toc-text">原生HTML+CSS+JAVASCRIPT渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaScript%E6%B8%B2%E6%9F%93"><span class="toc-number">2.1.1.</span> <span class="toc-text">JavaScript渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOM%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96"><span class="toc-number">2.1.2.</span> <span class="toc-text">DOM发生变化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9FDOM"><span class="toc-number">2.2.</span> <span class="toc-text">虚拟DOM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9FDOM%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">2.2.1.</span> <span class="toc-text">虚拟DOM的定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86"><span class="toc-number">2.3.</span> <span class="toc-text">React渲染原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fiber%E6%9E%B6%E6%9E%84"><span class="toc-number">2.3.1.</span> <span class="toc-text">Fiber架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Fiber%E8%8A%82%E7%82%B9"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">Fiber节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E5%99%A8-Scheduler"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">调度器 Scheduler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%88%87%E7%89%87-TimeSlice"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">时间切片 TimeSlice</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E9%87%8D%E7%BC%93%E5%86%B2-Double-Buffering"><span class="toc-number">2.3.1.4.</span> <span class="toc-text">双重缓冲 Double Buffering</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.2.</span> <span class="toc-text">渲染流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Render"><span class="toc-number">2.3.3.</span> <span class="toc-text">Render</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E7%BB%84%E4%BB%B6-%E6%B8%B2%E6%9F%93%E8%B5%B7%E7%82%B9"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">根组件-渲染起点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%99%9A%E6%8B%9FDOM%E6%A0%91"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">构建虚拟DOM树</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commit"><span class="toc-number">2.3.4.</span> <span class="toc-text">commit</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8A%B6%E6%80%81-State"><span class="toc-number">3.</span> <span class="toc-text">状态-State</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#State"><span class="toc-number">3.1.</span> <span class="toc-text">State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useState"><span class="toc-number">3.2.</span> <span class="toc-text">useState</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">3.2.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">3.2.2.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#State%E8%AF%A6%E8%A7%A3"><span class="toc-number">3.3.</span> <span class="toc-text">State详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#State%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">3.3.1.</span> <span class="toc-text">State作用域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#State%E5%B8%A7"><span class="toc-number">3.3.2.</span> <span class="toc-text">State帧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.3.</span> <span class="toc-text">状态更新函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86-Reducer"><span class="toc-number">4.</span> <span class="toc-text">状态管理-Reducer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#reducer"><span class="toc-number">4.1.</span> <span class="toc-text">reducer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89dispatch%E7%9A%84action"><span class="toc-number">4.1.1.</span> <span class="toc-text">定义dispatch的action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89reducer"><span class="toc-number">4.1.2.</span> <span class="toc-text">定义reducer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useReducer"><span class="toc-number">4.2.</span> <span class="toc-text">useReducer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9"><span class="toc-number">4.2.2.</span> <span class="toc-text">选择</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1-props%E3%80%81Context"><span class="toc-number">5.</span> <span class="toc-text">组件通信-props、Context</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#props"><span class="toc-number">5.1.</span> <span class="toc-text">props</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E9%97%B4%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1-%E7%88%B6-%E5%AD%90"><span class="toc-number">5.1.1.</span> <span class="toc-text">父子间组件通信(父-&gt;子)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%84%E5%BC%9F%E9%97%B4%E9%80%9A%E4%BF%A1%E2%80%94%E2%80%94%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87"><span class="toc-number">5.1.2.</span> <span class="toc-text">兄弟间通信——状态提升</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E2%80%94-%E7%88%B6"><span class="toc-number">5.1.3.</span> <span class="toc-text">子—&gt;父</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useContext"><span class="toc-number">5.2.</span> <span class="toc-text">useContext</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#context"><span class="toc-number">5.2.1.</span> <span class="toc-text">context</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useContext-1"><span class="toc-number">5.2.2.</span> <span class="toc-text">useContext</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E5%80%BC-Ref"><span class="toc-number">6.</span> <span class="toc-text">引用值-Ref</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#useRef"><span class="toc-number">6.1.</span> <span class="toc-text">useRef</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.1.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ref%E6%93%8D%E4%BD%9CDOM"><span class="toc-number">6.1.2.</span> <span class="toc-text">Ref操作DOM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#forwardRef"><span class="toc-number">6.2.</span> <span class="toc-text">forwardRef</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="toc-number">6.2.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">6.2.2.</span> <span class="toc-text">使用案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useImperativeHandle"><span class="toc-number">6.3.</span> <span class="toc-text">useImperativeHandle</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-3"><span class="toc-number">6.3.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B-1"><span class="toc-number">6.3.2.</span> <span class="toc-text">使用案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%AF%E4%BD%9C%E7%94%A8-Effect"><span class="toc-number">7.</span> <span class="toc-text">副作用-Effect</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#useEffect%E5%A3%B0%E6%98%8EEffect"><span class="toc-number">7.1.</span> <span class="toc-text">useEffect声明Effect</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#useEffect%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6"><span class="toc-number">7.1.1.</span> <span class="toc-text">useEffect运行机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-4"><span class="toc-number">7.1.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E9%A1%B9%E2%80%94%E2%80%94%E5%93%8D%E5%BA%94%E5%BC%8FEffect%E7%9A%84%E5%93%8D%E5%BA%94%E5%80%BC"><span class="toc-number">7.1.3.</span> <span class="toc-text">依赖项——响应式Effect的响应值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.4.</span> <span class="toc-text">清除函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useEffectEvent"><span class="toc-number">7.2.</span> <span class="toc-text">useEffectEvent</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89HOOK"><span class="toc-number">8.</span> <span class="toc-text">自定义HOOK</span></a></li></ol>
      
  </div>
</div>
</div>
      <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Tu Yuheng" class="lazyload">
  <div class="sidebar-author-name">Tu Yuheng</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    <div class="sidebar-state-number">4</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">0</div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">0</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="Home"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="Archives"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="About"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="Friend"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Friend</div>
    </div>
  
</div>
</div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js" integrity="sha384-3gT&#x2F;vsepWkfz&#x2F;ff7PpWNUeMzeWoH3cDhm&#x2F;A8jM7ouoAK0&#x2F;fP&#x2F;9bcHHR5kHq2nf+e" crossorigin="anonymous"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha384-J08i8An&#x2F;QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>



  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>



<script src="/js/pjax_script.js" data-pjax></script>







  
<script src="https://npm.webcache.cn/mouse-firework@0.0.6/dist/index.umd.js" integrity="sha384-vkGvf25gm1C1PbcoD5dNfc137HzNL&#x2F;hr1RKA5HniJOaawtvUmH5lTVFgFAruE9Ge" crossorigin="anonymous"></script>

  <script>
    window.firework && window.firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["#ff5252","#ff7c7c","#ffafaf","#ffd0d0"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["#ff0000"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'))
  </script>








<div id="lazy-script">
  <div>
    
    
      
        
<script src="/js/insert_highlight.js" data-pjax></script>

      
    
    
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js", "sha384-DiL6M/gG+wmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF/N6lrZi/")).default;
        
        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      








    
  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;')
    console.log('%c Theme.Reimu v' + '0.3.5' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #ff5252; padding:5px 0;', 'padding:4px;border:1px solid #ff5252;')
  </script>
  



  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" integrity="sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S" crossorigin="anonymous" async></script>




<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>

  <!-- hexo injector body_end start -->
<script src="/js/insert_highlight.js" data-pjax></script>
<!-- hexo injector body_end end --></body>
  </html>

